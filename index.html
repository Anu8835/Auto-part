<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Drawing Font Updater</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background: #222; color: white; padding: 10px; }
        .main-box { background: #333; padding: 15px; border-radius: 10px; max-width: 500px; margin: auto; }
        video { width: 100%; border-radius: 8px; border: 2px solid #555; }
        .btn { width: 100%; padding: 15px; margin-top: 10px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-scan { background: #007bff; color: white; }
        .btn-update { background: #28a745; color: white; }
        #output-text { color: #00ff00; font-size: 20px; margin: 10px 0; display: block; }
    </style>
</head>
<body>

<div class="main-box">
    <h3>Drawing Font Matcher</h3>
    <video id="video" autoplay playsinline></video>
    <span id="output-text">Scanning...</span>
    
    <button class="btn btn-scan" id="captureBtn">Part Scan Karein</button>
    <button class="btn btn-update" id="downloadBtn" disabled>Update Main Drawing</button>
</div>

<script>
    const video = document.getElementById('video');
    const outText = document.getElementById('output-text');
    const downloadBtn = document.getElementById('downloadBtn');
    let detectedMaterial = "";

    // Camera Start
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
        .then(stream => { video.srcObject = stream; })
        .catch(() => { alert("Camera Access Denied"); });

    // OCR Logic
    document.getElementById('captureBtn').addEventListener('click', async () => {
        outText.innerText = "Reading Part Font...";
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        
        const result = await Tesseract.recognize(canvas.toDataURL(), 'eng');
        detectedMaterial = result.data.text.trim();
        outText.innerText = "Detected: " + detectedMaterial;
        downloadBtn.disabled = false;
    });

    // Main Drawing PDF Update Logic
    downloadBtn.addEventListener('click', () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');

        // Font Settings (Matching physical part)
        doc.setFont("courier", "bold"); 
        
        // Header info from Original Drawing
        doc.setFontSize(8);
        doc.text("Drawing: Subrata Roy_FRONT_MUDFLAP_ENGV_24.01.2026", 10, 10);

        // Update Detail H Area
        doc.setFontSize(12);
        doc.text("DETAIL H (SCALE 1:1)", 20, 60);
        doc.setDrawColor(0);
        doc.rect(20, 65, 80, 40); // Detail box
        // Font update here
        doc.text("> " + detectedMaterial + " <", 35, 85); 

        // Update Detail J Area
        doc.text("DETAIL J (SCALE 1:1)", 20, 130);
        doc.rect(20, 135, 80, 40);
        // Font update here
        doc.text("> " + detectedMaterial + " <", 35, 155);

        // Save
        doc.save("Final_Updated_Drawing.pdf");
        outText.innerText = "Drawing Downloaded!";
    });
</script>

</body>
</html>